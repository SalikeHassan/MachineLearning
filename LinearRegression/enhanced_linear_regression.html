<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Regression Animation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .main-content {
            display: block;
            max-width: 100%;
        }
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
        }
        .info-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: white;
            background: linear-gradient(45deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .data-table {
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8f9ff;
        }
        .equation {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        .equation h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .math {
            font-family: 'Times New Roman', serif;
            font-size: 18px;
            color: #444;
            margin: 5px 0;
        }
        .current-line-info {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        .best-fit-info {
            background: #d4edda;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        .error-display {
            background: #f8d7da;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
            font-weight: 600;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: #f8f9fa;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
        #chart {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
        }
        .step-indicator {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
        }
        .residual-formula {
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 3px solid #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            text-align: center;
        }
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: center;
            }
            #calculationSection > div:first-child {
                grid-template-columns: 1fr !important;
            }
            table {
                font-size: 12px;
            }
            th, td {
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü•î Linear Regression: Finding the Best-Fit Line</h1>
        
        <div class="main-content">
            <div class="chart-container">
                <div class="controls">
                    <button onclick="startAnimation()">‚ñ∂Ô∏è Start Animation</button>
                    <button id="pauseToggle" onclick="togglePause()" style="display: none;">‚è∏Ô∏è Pause</button>
                    <button id="speedToggle" onclick="toggleSpeed()">üêå Slow Mode</button>
                    <button onclick="resetAnimation()">üîÑ Reset</button>
                    <button onclick="showBestFit()">‚≠ê Show Best Fit</button>
                    <button onclick="showWorstFit()">üíÄ Show Worst Fit</button>
                </div>
                <div class="step-indicator" id="stepIndicator">Click "Start Animation" to begin</div>
                <canvas id="chart" width="700" height="500"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #3498db;"></div>
                        <span>Data Points</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #e74c3c;"></div>
                        <span>Candidate Lines</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #27ae60;"></div>
                        <span>Best-Fit Line</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #8b0000;"></div>
                        <span>Worst-Fit Line</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #f39c12; height: 1px;"></div>
                        <span>Residuals</span>
                    </div>
                </div>
            </div>

            <div id="calculationSection" class="chart-container" style="display: none; margin-top: 20px;">
                <h3 style="text-align: center; color: #667eea; margin-bottom: 20px;">üìä Live Mathematical Calculations</h3>
                
                <!-- Residual Formula Section -->
                <div class="residual-formula">
                    <div style="font-size: 24px; font-weight: bold; color: #667eea; margin-bottom: 15px;">
                        RESIDUAL FORMULA
                    </div>
                    <div style="font-size: 32px; font-weight: bold; color: #e74c3c; font-family: 'Times New Roman', serif; margin: 20px 0;">
                        e<sub>i</sub> = y<sub>i</sub> - ≈∑<sub>i</sub>
                    </div>
                    <div style="font-size: 16px; color: #666; line-height: 1.6;">
                        <strong>Where:</strong> e<sub>i</sub> = residual (error), y<sub>i</sub> = actual value, ≈∑<sub>i</sub> = predicted value
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h4 style="color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Current Line Analysis</h4>
                        <div id="currentEquationDisplay" class="math" style="font-size: 20px; margin: 15px 0; color: #e74c3c; font-weight: bold;"></div>
                        <table id="calculationTable" style="width: 100%; margin-top: 15px;">
                            <thead>
                                <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                                    <th style="padding: 10px;">x</th>
                                    <th style="padding: 10px;">y (actual)</th>
                                    <th style="padding: 10px;">≈∑ (predicted)</th>
                                    <th style="padding: 10px;">Residual (e)</th>
                                    <th style="padding: 10px;">Residual¬≤</th>
                                </tr>
                            </thead>
                            <tbody id="calculationTableBody">
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <h4 style="color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Step-by-Step Calculation</h4>
                        <div id="stepByStepCalc" style="background: #f8f9ff; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">
                            <div style="margin-bottom: 15px;">
                                <strong>For line: <span id="currentLineEq2"></span></strong>
                            </div>
                            <div id="predictionSteps"></div>
                            <div id="residualSteps"></div>
                            <div id="sseCalculation" style="margin-top: 15px; padding: 15px; background: #fff; border-radius: 8px; border: 2px solid #667eea;">
                            </div>
                        </div>
                        <div id="comparisonBox" style="margin-top: 20px; padding: 15px; border-radius: 10px;">
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-panel" style="grid-column: 1 / -1; margin-top: 20px;">
                <div class="data-table">
                    <h3>üìä Potato Farming Data</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Fertilizer (kg)</th>
                                <th>Yield (tons)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>1</td><td>2</td></tr>
                            <tr><td>2</td><td>3</td></tr>
                            <tr><td>3</td><td>4</td></tr>
                            <tr><td>4</td><td>5</td></tr>
                            <tr><td>5</td><td>7</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="equation">
                    <h3>üìê Mathematical Connection: Line Equation ‚Üî Residual Formula</h3>
                    <div style="background: #e8f5e8; padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #28a745;">
                        
                        <div style="background: #fff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                            <p style="font-size: 18px; line-height: 1.6; margin: 0;">
                                The <strong>line equation</strong> and the <strong>residual formula</strong> form the foundation of linear regression.
                            </p>
                            <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.8;">
                                <li>The <strong>line equation</strong> generates predictions.</li>
                                <li>The <strong>residual formula</strong> measures how accurate those predictions are.</li>
                                <li>The <strong>SSE (sum of squared errors)</strong> tells us which line is the <em>best fit</em>.</li>
                            </ul>
                            <p style="margin: 15px 0 0 0; font-style: italic;">
                                And in practice, when using tools like Python, <strong>feature scaling</strong> often comes into play to make this process more stable.
                            </p>
                        </div>

                        <div style="background: #f0f4ff; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #667eea;">
                            <h4 style="color: #667eea; margin: 0 0 15px 0;">1. Line Equation: Predicting Outcomes</h4>
                            <div style="text-align: center; font-size: 24px; font-weight: bold; color: #667eea; margin: 15px 0;">
                                y = b‚ÇÄ + b‚ÇÅx
                            </div>
                            <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                                <li><strong>b‚ÇÄ (intercept)</strong>: Base value when x = 0.</li>
                                <li><strong>b‚ÇÅ (slope)</strong>: How much y changes when x increases by 1.</li>
                                <li><strong>≈∑·µ¢ (predicted y)</strong>: The model's estimate for input x·µ¢.</li>
                            </ul>
                            <div style="background: #667eea; color: white; padding: 12px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                üëâ Think of it as a <strong>prediction machine</strong>. Input fertilizer (x), output yield (≈∑).
                            </div>
                        </div>

                        <div style="background: #f0f4ff; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #667eea;">
                            <h4 style="color: #667eea; margin: 0 0 15px 0;">1. Complete Mathematical Derivation: Step-by-Step</h4>
                            
                            <div style="background: #fff; padding: 20px; border-radius: 10px; margin: 15px 0; border: 2px solid #667eea;">
                                <h5 style="color: #667eea; margin: 0 0 15px 0;">Step A: Finding the Best-Fit Line Equation y = b‚ÇÄ + b‚ÇÅx</h5>
                                
                                <div style="background: #f8f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step A1: Calculate Means (Averages)</h6>
                                    <p style="margin: 5px 0;">Given data: (1,2), (2,3), (3,4), (4,5), (5,7)</p>
                                    <div style="font-family: monospace; line-height: 1.8;">
                                        xÃÑ = (x‚ÇÅ + x‚ÇÇ + x‚ÇÉ + x‚ÇÑ + x‚ÇÖ) / 5<br>
                                        xÃÑ = (1 + 2 + 3 + 4 + 5) / 5<br>
                                        xÃÑ = 15 / 5 = <strong style="color: #667eea;">3.0</strong><br><br>
                                        
                                        »≥ = (y‚ÇÅ + y‚ÇÇ + y‚ÇÉ + y‚ÇÑ + y‚ÇÖ) / 5<br>
                                        »≥ = (2 + 3 + 4 + 5 + 7) / 5<br>
                                        »≥ = 21 / 5 = <strong style="color: #667eea;">4.2</strong>
                                    </div>
                                </div>
                                
                                <div style="background: #f8f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step A2: Calculate Slope (b‚ÇÅ)</h6>
                                    <p style="margin: 5px 0;">Formula: b‚ÇÅ = Œ£(x·µ¢ - xÃÑ)(y·µ¢ - »≥) / Œ£(x·µ¢ - xÃÑ)¬≤</p>
                                    
                                    <p style="margin: 10px 0;"><strong>Calculate Numerator: Œ£(x·µ¢ - xÃÑ)(y·µ¢ - »≥)</strong></p>
                                    <div style="font-family: monospace; line-height: 1.6;">
                                        Point 1: (x‚ÇÅ - xÃÑ)(y‚ÇÅ - »≥) = (1 - 3.0)(2 - 4.2) = (-2.0)(-2.2) = 4.4<br>
                                        Point 2: (x‚ÇÇ - xÃÑ)(y‚ÇÇ - »≥) = (2 - 3.0)(3 - 4.2) = (-1.0)(-1.2) = 1.2<br>
                                        Point 3: (x‚ÇÉ - xÃÑ)(y‚ÇÉ - »≥) = (3 - 3.0)(4 - 4.2) = (0.0)(-0.2) = 0.0<br>
                                        Point 4: (x‚ÇÑ - xÃÑ)(y‚ÇÑ - »≥) = (4 - 3.0)(5 - 4.2) = (1.0)(0.8) = 0.8<br>
                                        Point 5: (x‚ÇÖ - xÃÑ)(y‚ÇÖ - »≥) = (5 - 3.0)(7 - 4.2) = (2.0)(2.8) = 5.6<br><br>
                                        Numerator = 4.4 + 1.2 + 0.0 + 0.8 + 5.6 = <strong style="color: #667eea;">12.0</strong>
                                    </div>
                                    
                                    <p style="margin: 10px 0;"><strong>Calculate Denominator: Œ£(x·µ¢ - xÃÑ)¬≤</strong></p>
                                    <div style="font-family: monospace; line-height: 1.6;">
                                        Point 1: (x‚ÇÅ - xÃÑ)¬≤ = (1 - 3.0)¬≤ = (-2.0)¬≤ = 4.0<br>
                                        Point 2: (x‚ÇÇ - xÃÑ)¬≤ = (2 - 3.0)¬≤ = (-1.0)¬≤ = 1.0<br>
                                        Point 3: (x‚ÇÉ - xÃÑ)¬≤ = (3 - 3.0)¬≤ = (0.0)¬≤ = 0.0<br>
                                        Point 4: (x‚ÇÑ - xÃÑ)¬≤ = (4 - 3.0)¬≤ = (1.0)¬≤ = 1.0<br>
                                        Point 5: (x‚ÇÖ - xÃÑ)¬≤ = (5 - 3.0)¬≤ = (2.0)¬≤ = 4.0<br><br>
                                        Denominator = 4.0 + 1.0 + 0.0 + 1.0 + 4.0 = <strong style="color: #667eea;">10.0</strong>
                                    </div>
                                    
                                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                        <strong>b‚ÇÅ = Numerator / Denominator = 12.0 / 10.0 = 1.2</strong>
                                    </div>
                                </div>
                                
                                <div style="background: #f8f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step A3: Calculate Intercept (b‚ÇÄ)</h6>
                                    <p style="margin: 5px 0;">Formula: b‚ÇÄ = »≥ - b‚ÇÅxÃÑ</p>
                                    <div style="font-family: monospace; line-height: 1.8;">
                                        b‚ÇÄ = »≥ - b‚ÇÅxÃÑ<br>
                                        b‚ÇÄ = 4.2 - (1.2)(3.0)<br>
                                        b‚ÇÄ = 4.2 - 3.6<br>
                                        b‚ÇÄ = <strong style="color: #667eea;">0.6</strong>
                                    </div>
                                </div>
                                
                                <div style="background: #667eea; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                    <h6 style="margin: 0 0 10px 0;">FINAL LINE EQUATION:</h6>
                                    <div style="font-size: 24px; font-weight: bold;">y = 0.6 + 1.2x</div>
                                </div>
                            </div>
                            
                            <div style="background: #fff; padding: 20px; border-radius: 10px; margin: 15px 0; border: 2px solid #6f42c1;">
                                <h5 style="color: #6f42c1; margin: 0 0 15px 0;">Step B: Calculate Predicted Values (≈∑) Using Our Line</h5>
                                <p style="margin: 10px 0;">Now we use our equation y = 0.6 + 1.2x to predict ≈∑ for each x value:</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin: 15px 0;">
                                    <div style="background: #f8f9ff; padding: 12px; border-radius: 6px; border-left: 3px solid #6f42c1;">
                                        <strong>Step B1:</strong> For x‚ÇÅ = 1<br>
                                        ≈∑‚ÇÅ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÅ<br>
                                        ≈∑‚ÇÅ = 0.6 + 1.2 √ó 1<br>
                                        ≈∑‚ÇÅ = 0.6 + 1.2<br>
                                        ≈∑‚ÇÅ = <strong style="color: #6f42c1;">1.8</strong>
                                    </div>
                                    <div style="background: #f8f9ff; padding: 12px; border-radius: 6px; border-left: 3px solid #6f42c1;">
                                        <strong>Step B2:</strong> For x‚ÇÇ = 2<br>
                                        ≈∑‚ÇÇ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÇ<br>
                                        ≈∑‚ÇÇ = 0.6 + 1.2 √ó 2<br>
                                        ≈∑‚ÇÇ = 0.6 + 2.4<br>
                                        ≈∑‚ÇÇ = <strong style="color: #6f42c1;">3.0</strong>
                                    </div>
                                    <div style="background: #f8f9ff; padding: 12px; border-radius: 6px; border-left: 3px solid #6f42c1;">
                                        <strong>Step B3:</strong> For x‚ÇÉ = 3<br>
                                        ≈∑‚ÇÉ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÉ<br>
                                        ≈∑‚ÇÉ = 0.6 + 1.2 √ó 3<br>
                                        ≈∑‚ÇÉ = 0.6 + 3.6<br>
                                        ≈∑‚ÇÉ = <strong style="color: #6f42c1;">4.2</strong>
                                    </div>
                                    <div style="background: #f8f9ff; padding: 12px; border-radius: 6px; border-left: 3px solid #6f42c1;">
                                        <strong>Step B4:</strong> For x‚ÇÑ = 4<br>
                                        ≈∑‚ÇÑ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÑ<br>
                                        ≈∑‚ÇÑ = 0.6 + 1.2 √ó 4<br>
                                        ≈∑‚ÇÑ = 0.6 + 4.8<br>
                                        ≈∑‚ÇÑ = <strong style="color: #6f42c1;">5.4</strong>
                                    </div>
                                    <div style="background: #f8f9ff; padding: 12px; border-radius: 6px; border-left: 3px solid #6f42c1;">
                                        <strong>Step B5:</strong> For x‚ÇÖ = 5<br>
                                        ≈∑‚ÇÖ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÖ<br>
                                        ≈∑‚ÇÖ = 0.6 + 1.2 √ó 5<br>
                                        ≈∑‚ÇÖ = 0.6 + 6.0<br>
                                        ≈∑‚ÇÖ = <strong style="color: #6f42c1;">6.6</strong>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #fff; padding: 20px; border-radius: 10px; margin: 15px 0; border: 2px solid #f39c12;">
                                <h5 style="color: #f39c12; margin: 0 0 15px 0;">Step C: Calculate Residuals (Errors) Using e·µ¢ = y·µ¢ - ≈∑·µ¢</h5>
                                <p style="margin: 10px 0;">Now we compare actual y values with our predicted ≈∑ values:</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr; gap: 10px; margin: 15px 0;">
                                    <div style="background: #fff8f0; padding: 12px; border-radius: 6px; border-left: 3px solid #f39c12;">
                                        <strong>Step C1:</strong> Residual for Point 1<br>
                                        e‚ÇÅ = y‚ÇÅ - ≈∑‚ÇÅ<br>
                                        e‚ÇÅ = 2 - 1.8<br>
                                        e‚ÇÅ = <strong style="color: #f39c12;">0.2</strong> (Under-prediction: our line predicted too low)
                                    </div>
                                    <div style="background: #fff8f0; padding: 12px; border-radius: 6px; border-left: 3px solid #f39c12;">
                                        <strong>Step C2:</strong> Residual for Point 2<br>
                                        e‚ÇÇ = y‚ÇÇ - ≈∑‚ÇÇ<br>
                                        e‚ÇÇ = 3 - 3.0<br>
                                        e‚ÇÇ = <strong style="color: #f39c12;">0.0</strong> (Perfect prediction!)
                                    </div>
                                    <div style="background: #fff8f0; padding: 12px; border-radius: 6px; border-left: 3px solid #f39c12;">
                                        <strong>Step C3:</strong> Residual for Point 3<br>
                                        e‚ÇÉ = y‚ÇÉ - ≈∑‚ÇÉ<br>
                                        e‚ÇÉ = 4 - 4.2<br>
                                        e‚ÇÉ = <strong style="color: #f39c12;">-0.2</strong> (Over-prediction: our line predicted too high)
                                    </div>
                                    <div style="background: #fff8f0; padding: 12px; border-radius: 6px; border-left: 3px solid #f39c12;">
                                        <strong>Step C4:</strong> Residual for Point 4<br>
                                        e‚ÇÑ = y‚ÇÑ - ≈∑‚ÇÑ<br>
                                        e‚ÇÑ = 5 - 5.4<br>
                                        e‚ÇÑ = <strong style="color: #f39c12;">-0.4</strong> (Over-prediction: our line predicted too high)
                                    </div>
                                    <div style="background: #fff8f0; padding: 12px; border-radius: 6px; border-left: 3px solid #f39c12;">
                                        <strong>Step C5:</strong> Residual for Point 5<br>
                                        e‚ÇÖ = y‚ÇÖ - ≈∑‚ÇÖ<br>
                                        e‚ÇÖ = 7 - 6.6<br>
                                        e‚ÇÖ = <strong style="color: #f39c12;">0.4</strong> (Under-prediction: our line predicted too low)
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #fff; padding: 20px; border-radius: 10px; margin: 15px 0; border: 2px solid #dc3545;">
                                <h5 style="color: #dc3545; margin: 0 0 15px 0;">Step D: Calculate Sum of Squared Errors (SSE) to Determine Best Fit</h5>
                                <p style="margin: 10px 0;">We square each residual and add them up:</p>
                                
                                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #721c24; margin: 0 0 10px 0;">Step D1: Square Each Residual</h6>
                                    <div style="font-family: monospace; line-height: 1.8;">
                                        e‚ÇÅ¬≤ = (0.2)¬≤ = 0.04<br>
                                        e‚ÇÇ¬≤ = (0.0)¬≤ = 0.00<br>
                                        e‚ÇÉ¬≤ = (-0.2)¬≤ = 0.04<br>
                                        e‚ÇÑ¬≤ = (-0.4)¬≤ = 0.16<br>
                                        e‚ÇÖ¬≤ = (0.4)¬≤ = 0.16
                                    </div>
                                </div>
                                
                                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #721c24; margin: 0 0 10px 0;">Step D2: Sum All Squared Errors</h6>
                                    <div style="font-family: monospace; line-height: 1.8;">
                                        SSE = e‚ÇÅ¬≤ + e‚ÇÇ¬≤ + e‚ÇÉ¬≤ + e‚ÇÑ¬≤ + e‚ÇÖ¬≤<br>
                                        SSE = 0.04 + 0.00 + 0.04 + 0.16 + 0.16<br>
                                        SSE = <strong style="color: #dc3545;">0.40</strong>
                                    </div>
                                </div>
                                
                                <div style="background: #dc3545; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                    <strong>Why This is the Best Fit Line:</strong><br>
                                    This line y = 0.6 + 1.2x gives us the smallest possible SSE (0.40)<br>
                                    Any other line would produce a larger SSE!
                                </div>
                            </div>
                            
                            <div style="background: #667eea; color: white; padding: 12px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                Complete Mathematical Chain: Line Equation ‚Üí Predictions ‚Üí Residuals ‚Üí Best Fit Decision
                            </div>
                        </div>

                        <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #dc3545;">
                            <h4 style="color: #dc3545; margin: 0 0 15px 0;">1B. Example of Poor-Fitting Line: y = 2.0 + 0.5x</h4>
                            
                            <div style="background: #fff; padding: 20px; border-radius: 10px; margin: 15px 0; border: 2px solid #dc3545;">
                                <h5 style="color: #dc3545; margin: 0 0 15px 0;">Important Note: Where y = 2.0 + 0.5x Comes From</h5>
                                
                                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <p style="margin: 0; line-height: 1.6;"><strong>Key Point:</strong> Unlike our best-fit line y = 0.6 + 1.2x, the equation y = 2.0 + 0.5x was <strong>NOT</strong> mathematically derived from our potato farming data. Instead:</p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li><strong>b‚ÇÄ = 2.0</strong> was chosen arbitrarily (different from optimal 0.6)</li>
                                        <li><strong>b‚ÇÅ = 0.5</strong> was chosen arbitrarily (different from optimal 1.2)</li>
                                        <li>This represents what happens when we use a <strong>wrong line</strong> for our data</li>
                                        <li>It demonstrates why the least squares method is necessary</li>
                                    </ul>
                                </div>
                                
                                <h6 style="color: #dc3545; margin: 15px 0 10px 0;">Alternative Scenario: What Data Would Give Us y = 2.0 + 0.5x?</h6>
                                <p style="margin: 10px 0;">If we had different data points, we might get y = 2.0 + 0.5x. For example:</p>
                                <div style="background: #fff; padding: 10px; border-radius: 5px; border: 1px solid #dc3545; margin: 10px 0;">
                                    <strong>Hypothetical Data:</strong> (1, 2.5), (2, 3.0), (3, 3.5), (4, 4.0), (5, 4.5)<br>
                                    <em>This would give us a line with lower slope and higher intercept</em>
                                </div>
                                
                                <h6 style="color: #dc3545; margin: 15px 0 10px 0;">Step-by-Step: Testing y = 2.0 + 0.5x on Our Actual Data</h6>
                                <p style="margin: 10px 0;">Let's see what happens when we force this wrong line onto our potato farming data: (1,2), (2,3), (3,4), (4,5), (5,7)</p>
                                
                                <div style="background: #fff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step 1B-A: Calculate Predicted Values Using y = 2.0 + 0.5x</h6>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr; gap: 8px; margin: 15px 0;">
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-A1:</strong> For x‚ÇÅ = 1<br>
                                            ≈∑‚ÇÅ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÅ<br>
                                            ≈∑‚ÇÅ = 2.0 + 0.5 √ó 1<br>
                                            ≈∑‚ÇÅ = 2.0 + 0.5<br>
                                            ≈∑‚ÇÅ = <strong style="color: #dc3545;">2.5</strong>
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-A2:</strong> For x‚ÇÇ = 2<br>
                                            ≈∑‚ÇÇ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÇ<br>
                                            ≈∑‚ÇÇ = 2.0 + 0.5 √ó 2<br>
                                            ≈∑‚ÇÇ = 2.0 + 1.0<br>
                                            ≈∑‚ÇÇ = <strong style="color: #dc3545;">3.0</strong>
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-A3:</strong> For x‚ÇÉ = 3<br>
                                            ≈∑‚ÇÉ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÉ<br>
                                            ≈∑‚ÇÉ = 2.0 + 0.5 √ó 3<br>
                                            ≈∑‚ÇÉ = 2.0 + 1.5<br>
                                            ≈∑‚ÇÉ = <strong style="color: #dc3545;">3.5</strong>
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-A4:</strong> For x‚ÇÑ = 4<br>
                                            ≈∑‚ÇÑ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÑ<br>
                                            ≈∑‚ÇÑ = 2.0 + 0.5 √ó 4<br>
                                            ≈∑‚ÇÑ = 2.0 + 2.0<br>
                                            ≈∑‚ÇÑ = <strong style="color: #dc3545;">4.0</strong>
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-A5:</strong> For x‚ÇÖ = 5<br>
                                            ≈∑‚ÇÖ = b‚ÇÄ + b‚ÇÅ √ó x‚ÇÖ<br>
                                            ≈∑‚ÇÖ = 2.0 + 0.5 √ó 5<br>
                                            ≈∑‚ÇÖ = 2.0 + 2.5<br>
                                            ≈∑‚ÇÖ = <strong style="color: #dc3545;">4.5</strong>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: #fff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step 1B-B: Calculate Residuals Using e·µ¢ = y·µ¢ - ≈∑·µ¢</h6>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr; gap: 8px; margin: 15px 0;">
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-B1:</strong> Residual for Point 1<br>
                                            e‚ÇÅ = y‚ÇÅ - ≈∑‚ÇÅ<br>
                                            e‚ÇÅ = 2 - 2.5<br>
                                            e‚ÇÅ = <strong style="color: #dc3545;">-0.5</strong> (Over-prediction: line too high)
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-B2:</strong> Residual for Point 2<br>
                                            e‚ÇÇ = y‚ÇÇ - ≈∑‚ÇÇ<br>
                                            e‚ÇÇ = 3 - 3.0<br>
                                            e‚ÇÇ = <strong style="color: #dc3545;">0.0</strong> (Perfect prediction by luck!)
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-B3:</strong> Residual for Point 3<br>
                                            e‚ÇÉ = y‚ÇÉ - ≈∑‚ÇÉ<br>
                                            e‚ÇÉ = 4 - 3.5<br>
                                            e‚ÇÉ = <strong style="color: #dc3545;">0.5</strong> (Under-prediction: line too low)
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-B4:</strong> Residual for Point 4<br>
                                            e‚ÇÑ = y‚ÇÑ - ≈∑‚ÇÑ<br>
                                            e‚ÇÑ = 5 - 4.0<br>
                                            e‚ÇÑ = <strong style="color: #dc3545;">1.0</strong> (Under-prediction: line too low)
                                        </div>
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; border-left: 3px solid #dc3545;">
                                            <strong>Step 1B-B5:</strong> Residual for Point 5<br>
                                            e‚ÇÖ = y‚ÇÖ - ≈∑‚ÇÖ<br>
                                            e‚ÇÖ = 7 - 4.5<br>
                                            e‚ÇÖ = <strong style="color: #dc3545;">2.5</strong> (Huge under-prediction!)
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: #fff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step 1B-C: Calculate SSE for Poor-Fitting Line</h6>
                                    
                                    <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                        <h6 style="color: #721c24; margin: 0 0 10px 0;">Square Each Residual:</h6>
                                        <div style="font-family: monospace; line-height: 1.8;">
                                            e‚ÇÅ¬≤ = (-0.5)¬≤ = 0.25<br>
                                            e‚ÇÇ¬≤ = (0.0)¬≤ = 0.00<br>
                                            e‚ÇÉ¬≤ = (0.5)¬≤ = 0.25<br>
                                            e‚ÇÑ¬≤ = (1.0)¬≤ = 1.00<br>
                                            e‚ÇÖ¬≤ = (2.5)¬≤ = 6.25
                                        </div>
                                    </div>
                                    
                                    <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                        <h6 style="color: #721c24; margin: 0 0 10px 0;">Sum All Squared Errors:</h6>
                                        <div style="font-family: monospace; line-height: 1.8;">
                                            SSE = e‚ÇÅ¬≤ + e‚ÇÇ¬≤ + e‚ÇÉ¬≤ + e‚ÇÑ¬≤ + e‚ÇÖ¬≤<br>
                                            SSE = 0.25 + 0.00 + 0.25 + 1.00 + 6.25<br>
                                            SSE = <strong style="color: #dc3545;">7.75</strong>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: #dc3545; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                    <strong>Comparison: Best vs Poor Line</strong><br>
                                    Best-fit y = 0.6 + 1.2x ‚Üí SSE = 0.40<br>
                                    Poor-fit y = 2.0 + 0.5x ‚Üí SSE = 7.75<br>
                                    <em>The poor line has 19.4 times more error!</em>
                                </div>
                            </div>
                        </div>

                        <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #2196f3;">
                            <h4 style="color: #2196f3; margin: 0 0 15px 0;">1C. Mathematical Derivation: Finding y = 2.0 + 0.5x with Different Data</h4>
                            
                            <div style="background: #fff; padding: 20px; border-radius: 10px; margin: 15px 0; border: 2px solid #2196f3;">
                                <div style="background: #cce7ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #0056b3; margin: 0 0 10px 0;">Important Mathematical Note:</h6>
                                    <p style="margin: 0; line-height: 1.6;">The equation y = 2.0 + 0.5x <strong>CANNOT</strong> be derived from our potato farming data (1,2), (2,3), (3,4), (4,5), (5,7) using least squares method. The least squares method gives a unique solution for any dataset.</p>
                                    <p style="margin: 10px 0 0 0;"><strong>To get y = 2.0 + 0.5x, we need different data points.</strong> Let me show you hypothetical data that would mathematically produce this equation:</p>
                                </div>
                                
                                <h5 style="color: #2196f3; margin: 15px 0;">Hypothetical Dataset That Gives y = 2.0 + 0.5x</h5>
                                <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <strong>New Data Points:</strong> (1, 2.5), (2, 3.0), (3, 3.5), (4, 4.0), (5, 4.5)<br>
                                    <em>These points lie exactly on the line y = 2.0 + 0.5x</em>
                                </div>
                                
                                <h5 style="color: #2196f3; margin: 20px 0 15px 0;">Step A: Finding Line Equation y = b‚ÇÄ + b‚ÇÅx</h5>
                                
                                <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step A1: Calculate Means (Averages)</h6>
                                    <p style="margin: 5px 0;">Given data: (1, 2.5), (2, 3.0), (3, 3.5), (4, 4.0), (5, 4.5)</p>
                                    <div style="font-family: monospace; line-height: 1.8;">
                                        xÃÑ = (x‚ÇÅ + x‚ÇÇ + x‚ÇÉ + x‚ÇÑ + x‚ÇÖ) / 5<br>
                                        xÃÑ = (1 + 2 + 3 + 4 + 5) / 5<br>
                                        xÃÑ = 15 / 5 = <strong style="color: #2196f3;">3.0</strong><br><br>
                                        
                                        »≥ = (y‚ÇÅ + y‚ÇÇ + y‚ÇÉ + y‚ÇÑ + y‚ÇÖ) / 5<br>
                                        »≥ = (2.5 + 3.0 + 3.5 + 4.0 + 4.5) / 5<br>
                                        »≥ = 17.5 / 5 = <strong style="color: #2196f3;">3.5</strong>
                                    </div>
                                </div>
                                
                                <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step A2: Calculate Slope (b‚ÇÅ)</h6>
                                    <p style="margin: 5px 0;">Formula: b‚ÇÅ = Œ£(x·µ¢ - xÃÑ)(y·µ¢ - »≥) / Œ£(x·µ¢ - xÃÑ)¬≤</p>
                                    
                                    <p style="margin: 10px 0;"><strong>Calculate Numerator: Œ£(x·µ¢ - xÃÑ)(y·µ¢ - »≥)</strong></p>
                                    <div style="font-family: monospace; line-height: 1.6;">
                                        Point 1: (x‚ÇÅ - xÃÑ)(y‚ÇÅ - »≥) = (1 - 3.0)(2.5 - 3.5) = (-2.0)(-1.0) = 2.0<br>
                                        Point 2: (x‚ÇÇ - xÃÑ)(y‚ÇÇ - »≥) = (2 - 3.0)(3.0 - 3.5) = (-1.0)(-0.5) = 0.5<br>
                                        Point 3: (x‚ÇÉ - xÃÑ)(y‚ÇÉ - »≥) = (3 - 3.0)(3.5 - 3.5) = (0.0)(0.0) = 0.0<br>
                                        Point 4: (x‚ÇÑ - xÃÑ)(y‚ÇÑ - »≥) = (4 - 3.0)(4.0 - 3.5) = (1.0)(0.5) = 0.5<br>
                                        Point 5: (x‚ÇÖ - xÃÑ)(y‚ÇÖ - »≥) = (5 - 3.0)(4.5 - 3.5) = (2.0)(1.0) = 2.0<br><br>
                                        Numerator = 2.0 + 0.5 + 0.0 + 0.5 + 2.0 = <strong style="color: #2196f3;">5.0</strong>
                                    </div>
                                    
                                    <p style="margin: 10px 0;"><strong>Calculate Denominator: Œ£(x·µ¢ - xÃÑ)¬≤</strong></p>
                                    <div style="font-family: monospace; line-height: 1.6;">
                                        Point 1: (x‚ÇÅ - xÃÑ)¬≤ = (1 - 3.0)¬≤ = (-2.0)¬≤ = 4.0<br>
                                        Point 2: (x‚ÇÇ - xÃÑ)¬≤ = (2 - 3.0)¬≤ = (-1.0)¬≤ = 1.0<br>
                                        Point 3: (x‚ÇÉ - xÃÑ)¬≤ = (3 - 3.0)¬≤ = (0.0)¬≤ = 0.0<br>
                                        Point 4: (x‚ÇÑ - xÃÑ)¬≤ = (4 - 3.0)¬≤ = (1.0)¬≤ = 1.0<br>
                                        Point 5: (x‚ÇÖ - xÃÑ)¬≤ = (5 - 3.0)¬≤ = (2.0)¬≤ = 4.0<br><br>
                                        Denominator = 4.0 + 1.0 + 0.0 + 1.0 + 4.0 = <strong style="color: #2196f3;">10.0</strong>
                                    </div>
                                    
                                    <div style="background: #2196f3; color: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                        <strong>b‚ÇÅ = Numerator / Denominator = 5.0 / 10.0 = 0.5</strong>
                                    </div>
                                </div>
                                
                                <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <h6 style="color: #495057; margin: 0 0 10px 0;">Step A3: Calculate Intercept (b‚ÇÄ)</h6>
                                    <p style="margin: 5px 0;">Formula: b‚ÇÄ = »≥ - b‚ÇÅxÃÑ</p>
                                    <div style="font-family: monospace; line-height: 1.8;">
                                        b‚ÇÄ = »≥ - b‚ÇÅxÃÑ<br>
                                        b‚ÇÄ = 3.5 - (0.5)(3.0)<br>
                                        b‚ÇÄ = 3.5 - 1.5<br>
                                        b‚ÇÄ = <strong style="color: #2196f3;">2.0</strong>
                                    </div>
                                </div>
                                
                                <div style="background: #2196f3; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                    <h6 style="margin: 0 0 10px 0;">FINAL LINE EQUATION FROM NEW DATA:</h6>
                                    <div style="font-size: 24px; font-weight: bold;">y = 2.0 + 0.5x</div>
                                </div>
                                
                                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                                    <h6 style="color: #856404; margin: 0 0 10px 0;">Key Learning Point:</h6>
                                    <p style="margin: 0; line-height: 1.6;">
                                        <strong>Different data = Different best-fit line.</strong> Our original potato data mathematically requires y = 0.6 + 1.2x. 
                                        This hypothetical data mathematically requires y = 2.0 + 0.5x. The least squares method always finds the unique best solution for any given dataset.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div style="background: #fff8f0; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #f39c12;">
                            <h4 style="color: #f39c12; margin: 0 0 15px 0;">2. Residual Formula: Measuring Errors</h4>
                            <p style="margin: 10px 0;">Residuals check how far the prediction was from reality:</p>
                            <div style="text-align: center; font-size: 24px; font-weight: bold; color: #f39c12; margin: 15px 0;">
                                e·µ¢ = y·µ¢ - ≈∑·µ¢
                            </div>
                            <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                                <li>e·µ¢ > 0 ‚Üí Line <strong>underestimated</strong> (prediction too low).</li>
                                <li>e·µ¢ < 0 ‚Üí Line <strong>overestimated</strong> (prediction too high).</li>
                                <li>e·µ¢ = 0 ‚Üí Perfect prediction.</li>
                            </ul>
                            <div style="background: #f39c12; color: white; padding: 12px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                üëâ Residuals are the <strong>report card</strong> for predictions.
                            </div>
                        </div>

                        <div style="background: #f8f9ff; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #17a2b8;">
                            <h4 style="color: #17a2b8; margin: 0 0 15px 0;">3. The Bridge: How They Connect</h4>
                            <ol style="margin: 15px 0; padding-left: 20px; line-height: 1.8; font-size: 16px;">
                                <li>Choose a line y = b‚ÇÄ + b‚ÇÅx.</li>
                                <li>Predict: ≈∑·µ¢ = b‚ÇÄ + b‚ÇÅx·µ¢.</li>
                                <li>Measure error: e·µ¢ = y·µ¢ - ≈∑·µ¢.</li>
                                <li>Square and sum: SSE = Œ£e·µ¢¬≤.</li>
                                <li>Compare different lines ‚Üí smallest SSE wins.</li>
                            </ol>
                            <div style="background: #17a2b8; color: white; padding: 12px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                üîó <strong>Equation predicts ‚Üí Residuals evaluate ‚Üí SSE decides best line.</strong>
                            </div>
                        </div>

                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #ffc107;">
                            <h4 style="color: #856404; margin: 0 0 15px 0;">4. Key Insight</h4>
                            <p style="margin: 10px 0; font-size: 16px; line-height: 1.6;">
                                Regression is not "eyeballing a good line."<br>
                                It's a <strong>systematic process</strong>:
                            </p>
                            <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                                <li>Try different b‚ÇÄ, b‚ÇÅ.</li>
                                <li>Generate predictions.</li>
                                <li>Measure residuals.</li>
                                <li>Compute SSE.</li>
                                <li>Pick the line with the smallest SSE.</li>
                            </ul>
                        </div>

                        <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #2196f3;">
                            <h4 style="color: #1565c0; margin: 0 0 15px 0;">5. Feature Scaling: Practical Twist</h4>
                            <p style="margin: 10px 0;">In real implementations (like Python scikit-learn), we often <strong>scale features</strong> before fitting the line:</p>
                            
                            <div style="margin: 15px 0;">
                                <h5 style="color: #1565c0; margin: 0 0 10px 0;">Why scale?</h5>
                                <ul style="margin: 10px 0; padding-left: 20px; line-height: 1.6;">
                                    <li>Different units (e.g., fertilizer in kg vs yield in tons) can skew calculations.</li>
                                    <li>Scaling makes optimization (finding best b‚ÇÄ, b‚ÇÅ) more stable.</li>
                                    <li>Gradient descent converges faster with scaled values.</li>
                                </ul>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <h5 style="color: #1565c0; margin: 0 0 10px 0;">Impact on Residuals:</h5>
                                <ul style="margin: 10px 0; padding-left: 20px; line-height: 1.6;">
                                    <li>Residuals are still computed in the same way: e·µ¢ = y·µ¢ - ≈∑·µ¢.</li>
                                    <li>If y is not scaled but x is, the residuals remain in the original y-units (so interpretation is consistent).</li>
                                    <li>Scaling x just helps the model find better parameters more efficiently.</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h4 style="color: #155724; margin-top: 0; text-align: center;">The Bridge Between Line Equation and Residuals</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center; margin: 20px 0;">
                            <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 2px solid #667eea;">
                                <strong>Line Equation</strong><br>
                                <span style="font-size: 24px; color: #667eea;">y = b‚ÇÄ + b‚ÇÅx</span><br>
                                <small>Predicts yield for any fertilizer amount</small>
                            </div>
                            <div style="font-size: 30px; color: #28a745;">‚Üí</div>
                            <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 2px solid #e74c3c;">
                                <strong>Residual Formula</strong><br>
                                <span style="font-size: 24px; color: #e74c3c;">e·µ¢ = y·µ¢ - ≈∑·µ¢</span><br>
                                <small>Measures prediction accuracy</small>
                            </div>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <h5 style="color: #856404; margin: 0 0 15px 0;">üîç Step-by-Step Mathematical Connection:</h5>
                            
                            <p><strong>Step 1: Use Line Equation to Calculate Predicted Value</strong></p>
                            <div style="background: #f8f9ff; padding: 15px; border-radius: 8px; margin: 10px 0; font-family: monospace;">
                                For any data point (x·µ¢, y·µ¢), we calculate:<br>
                                <strong>≈∑·µ¢ = b‚ÇÄ + b‚ÇÅ √ó x·µ¢</strong> ‚Üê This comes from our line equation!<br><br>
                                Example with point (x=1, y=2) and line y = 0.6 + 1.2x:<br>
                                ≈∑‚ÇÅ = 0.6 + 1.2 √ó 1 = 0.6 + 1.2 = <strong>1.8</strong>
                            </div>
                            
                            <p><strong>Step 2: Calculate Residual Using Predicted Value</strong></p>
                            <div style="background: #fff8f0; padding: 15px; border-radius: 8px; margin: 10px 0; font-family: monospace;">
                                Now we can find the prediction error:<br>
                                <strong>e‚ÇÅ = y‚ÇÅ - ≈∑‚ÇÅ = 2 - 1.8 = 0.2</strong><br><br>
                                This tells us our line predicted 0.2 tons too low!
                            </div>
                            
                            <p><strong>Step 3: Repeat for All Points</strong></p>
                            <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                ‚Ä¢ Point (1,2): ≈∑‚ÇÅ = 0.6 + 1.2(1) = 1.8 ‚Üí e‚ÇÅ = 2 - 1.8 = 0.2<br>
                                ‚Ä¢ Point (2,3): ≈∑‚ÇÇ = 0.6 + 1.2(2) = 3.0 ‚Üí e‚ÇÇ = 3 - 3.0 = 0.0<br>
                                ‚Ä¢ Point (3,4): ≈∑‚ÇÉ = 0.6 + 1.2(3) = 4.2 ‚Üí e‚ÇÉ = 4 - 4.2 = -0.2<br>
                                ‚Ä¢ Point (4,5): ≈∑‚ÇÑ = 0.6 + 1.2(4) = 5.4 ‚Üí e‚ÇÑ = 5 - 5.4 = -0.4<br>
                                ‚Ä¢ Point (5,7): ≈∑‚ÇÖ = 0.6 + 1.2(5) = 6.6 ‚Üí e‚ÇÖ = 7 - 6.6 = 0.4
                            </div>
                            
                            <p><strong>Step 4: Find Best Line by Minimizing Total Error</strong></p>
                            <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <strong>SSE = e‚ÇÅ¬≤ + e‚ÇÇ¬≤ + e‚ÇÉ¬≤ + e‚ÇÑ¬≤ + e‚ÇÖ¬≤</strong><br>
                                SSE = (0.2)¬≤ + (0.0)¬≤ + (-0.2)¬≤ + (-0.4)¬≤ + (0.4)¬≤<br>
                                SSE = 0.04 + 0.00 + 0.04 + 0.16 + 0.16 = <strong>0.40</strong><br><br>
                                The line with the smallest SSE is our best fit!
                            </div>
                        </div>
                        
                        <div style="background: #d1ecf1; padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <h5 style="color: #0c5460; margin: 0 0 10px 0;">üéØ Key Insight: The Connection</h5>
                            <p style="margin: 0; font-size: 16px; line-height: 1.6;">
                                <strong>The line equation y = b‚ÇÄ + b‚ÇÅx creates the ≈∑·µ¢ values that go into the residual formula e·µ¢ = y·µ¢ - ≈∑·µ¢.</strong><br><br>
                                We test different values of b‚ÇÄ and b‚ÇÅ ‚Üí Each gives different ≈∑·µ¢ predictions ‚Üí Each produces different residuals e·µ¢ ‚Üí 
                                The b‚ÇÄ and b‚ÇÅ that minimize Œ£e·µ¢¬≤ become our final best-fit line!
                            </p>
                        </div>
                        
                        <div style="background: #fff; padding: 25px; border-radius: 15px; margin: 20px 0; border: 2px solid #17a2b8;">
                            <h4 style="color: #17a2b8; margin-top: 0; text-align: center;">üìä Detailed Comparison: Best Line vs Worst Line</h4>
                            <p style="text-align: center; color: #6c757d; margin-bottom: 20px;"><strong>Your understanding is CORRECT!</strong> After finding line values, we calculate residuals to determine best fit. Smaller SSE = Better line!</p>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin: 20px 0;">
                                <!-- Best Line Example -->
                                <div style="background: #d4edda; padding: 20px; border-radius: 12px; border: 2px solid #28a745;">
                                    <h5 style="color: #155724; margin: 0 0 15px 0; text-align: center;">üèÜ BEST-FIT LINE EXAMPLE</h5>
                                    <div style="text-align: center; font-size: 18px; font-weight: bold; color: #28a745; margin-bottom: 15px;">
                                        y = 0.6 + 1.2x
                                    </div>
                                    
                                    <p style="margin: 10px 0;"><strong>Step-by-Step Calculations:</strong></p>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #28a745;">
                                        <strong>Point 1:</strong> (x=1, y=2)<br>
                                        ≈∑‚ÇÅ = 0.6 + 1.2(1) = 1.8<br>
                                        e‚ÇÅ = 2 - 1.8 = <strong style="color: #28a745;">0.2</strong><br>
                                        e‚ÇÅ¬≤ = (0.2)¬≤ = 0.04
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #28a745;">
                                        <strong>Point 2:</strong> (x=2, y=3)<br>
                                        ≈∑‚ÇÇ = 0.6 + 1.2(2) = 3.0<br>
                                        e‚ÇÇ = 3 - 3.0 = <strong style="color: #28a745;">0.0</strong><br>
                                        e‚ÇÇ¬≤ = (0.0)¬≤ = 0.00
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #28a745;">
                                        <strong>Point 3:</strong> (x=3, y=4)<br>
                                        ≈∑‚ÇÉ = 0.6 + 1.2(3) = 4.2<br>
                                        e‚ÇÉ = 4 - 4.2 = <strong style="color: #28a745;">-0.2</strong><br>
                                        e‚ÇÉ¬≤ = (-0.2)¬≤ = 0.04
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #28a745;">
                                        <strong>Point 4:</strong> (x=4, y=5)<br>
                                        ≈∑‚ÇÑ = 0.6 + 1.2(4) = 5.4<br>
                                        e‚ÇÑ = 5 - 5.4 = <strong style="color: #28a745;">-0.4</strong><br>
                                        e‚ÇÑ¬≤ = (-0.4)¬≤ = 0.16
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #28a745;">
                                        <strong>Point 5:</strong> (x=5, y=7)<br>
                                        ≈∑‚ÇÖ = 0.6 + 1.2(5) = 6.6<br>
                                        e‚ÇÖ = 7 - 6.6 = <strong style="color: #28a745;">0.4</strong><br>
                                        e‚ÇÖ¬≤ = (0.4)¬≤ = 0.16
                                    </div>
                                    
                                    <div style="background: #28a745; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                        <strong>SSE = 0.04 + 0.00 + 0.04 + 0.16 + 0.16 = 0.40</strong><br>
                                        <em>Small residuals = Excellent fit!</em>
                                    </div>
                                </div>
                                
                                <!-- Worst Line Example -->
                                <div style="background: #f8d7da; padding: 20px; border-radius: 12px; border: 2px solid #dc3545;">
                                    <h5 style="color: #721c24; margin: 0 0 15px 0; text-align: center;">üíÄ WORST-FIT LINE EXAMPLE</h5>
                                    <div style="text-align: center; font-size: 18px; font-weight: bold; color: #dc3545; margin-bottom: 15px;">
                                        y = 2.0 + 0.5x
                                    </div>
                                    
                                    <p style="margin: 10px 0;"><strong>Step-by-Step Calculations:</strong></p>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #dc3545;">
                                        <strong>Point 1:</strong> (x=1, y=2)<br>
                                        ≈∑‚ÇÅ = 2.0 + 0.5(1) = 2.5<br>
                                        e‚ÇÅ = 2 - 2.5 = <strong style="color: #dc3545;">-0.5</strong><br>
                                        e‚ÇÅ¬≤ = (-0.5)¬≤ = 0.25
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #dc3545;">
                                        <strong>Point 2:</strong> (x=2, y=3)<br>
                                        ≈∑‚ÇÇ = 2.0 + 0.5(2) = 3.0<br>
                                        e‚ÇÇ = 3 - 3.0 = <strong style="color: #dc3545;">0.0</strong><br>
                                        e‚ÇÇ¬≤ = (0.0)¬≤ = 0.00
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #dc3545;">
                                        <strong>Point 3:</strong> (x=3, y=4)<br>
                                        ≈∑‚ÇÉ = 2.0 + 0.5(3) = 3.5<br>
                                        e‚ÇÉ = 4 - 3.5 = <strong style="color: #dc3545;">0.5</strong><br>
                                        e‚ÇÉ¬≤ = (0.5)¬≤ = 0.25
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #dc3545;">
                                        <strong>Point 4:</strong> (x=4, y=5)<br>
                                        ≈∑‚ÇÑ = 2.0 + 0.5(4) = 4.0<br>
                                        e‚ÇÑ = 5 - 4.0 = <strong style="color: #dc3545;">1.0</strong><br>
                                        e‚ÇÑ¬≤ = (1.0)¬≤ = 1.00
                                    </div>
                                    
                                    <div style="background: #fff; padding: 12px; border-radius: 8px; margin: 8px 0; border-left: 4px solid #dc3545;">
                                        <strong>Point 5:</strong> (x=5, y=7)<br>
                                        ≈∑‚ÇÖ = 2.0 + 0.5(5) = 4.5<br>
                                        e‚ÇÖ = 7 - 4.5 = <strong style="color: #dc3545;">2.5</strong><br>
                                        e‚ÇÖ¬≤ = (2.5)¬≤ = 6.25
                                    </div>
                                    
                                    <div style="background: #dc3545; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                        <strong>SSE = 0.25 + 0.00 + 0.25 + 1.00 + 6.25 = 7.75</strong><br>
                                        <em>Large residuals = Terrible fit!</em>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 5px solid #ffc107;">
                                <h5 style="color: #856404; margin: 0 0 15px 0;">üîç Analysis: Why One is Better Than the Other</h5>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                                    <div>
                                        <h6 style="color: #28a745; margin: 0 0 10px 0;">‚úÖ Best Line (SSE = 0.40)</h6>
                                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                                            <li><strong>Small residuals:</strong> Most errors under 0.5</li>
                                            <li><strong>Balanced errors:</strong> Some positive, some negative</li>
                                            <li><strong>Low SSE:</strong> Total error is minimal</li>
                                            <li><strong>Good predictions:</strong> Close to actual values</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h6 style="color: #dc3545; margin: 0 0 10px 0;">‚ùå Worst Line (SSE = 7.75)</h6>
                                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                                            <li><strong>Large residuals:</strong> Errors up to 2.5!</li>
                                            <li><strong>Systematic error:</strong> Consistently under-predicts</li>
                                            <li><strong>High SSE:</strong> 19x larger than best line!</li>
                                            <li><strong>Poor predictions:</strong> Far from actual values</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div style="background: #17a2b8; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 15px;">
                                    <strong>üéØ CONCLUSION: SSE of 0.40 vs 7.75 proves that smaller SSE = better line!</strong><br>
                                    <em>This is exactly why we test many lines and choose the one with minimum SSE.</em>
                                </div>
                            </div>
                            
                            <div style="background: #e8f4fd; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 5px solid #2196f3;">
                                <h5 style="color: #1565c0; margin: 0 0 15px 0;">üß† The Complete Process Flow</h5>
                                <div style="font-size: 16px; line-height: 1.8;">
                                    <strong>1.</strong> Start with a line equation: <code>y = b‚ÇÄ + b‚ÇÅx</code><br>
                                    <strong>2.</strong> Calculate predicted values: <code>≈∑·µ¢ = b‚ÇÄ + b‚ÇÅ √ó x·µ¢</code><br>
                                    <strong>3.</strong> Find residuals: <code>e·µ¢ = y·µ¢ - ≈∑·µ¢</code><br>
                                    <strong>4.</strong> Calculate SSE: <code>SSE = Œ£e·µ¢¬≤</code><br>
                                    <strong>5.</strong> Compare SSE values: <strong>Smaller SSE = Better Line</strong><br>
                                    <strong>6.</strong> Choose the line with minimum SSE as your best-fit line!<br><br>
                                    
                                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #2196f3; text-align: center;">
                                        <strong style="color: #1565c0;">Your Understanding is 100% Correct!</strong><br>
                                        <em>Every line must be tested ‚Üí Calculate its residuals ‚Üí Find SSE ‚Üí Pick the smallest SSE!</em>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="equation">
                    <h3>üìö Understanding Linear Regression</h3>
                    <div style="text-align: left; line-height: 1.6;">
                        <p><strong>1. Concept:</strong> Linear regression helps us predict a dependent variable (like potato yield) based on an independent variable (like the amount of fertilizer).</p>
                        
                        <p><strong>2. Equation:</strong> The model is represented as <span class="math">y = b‚ÇÄ + b‚ÇÅx</span>, where:</p>
                        <ul style="margin: 10px 0;">
                            <li><strong>y</strong> is the predicted yield</li>
                            <li><strong>x</strong> is the amount of fertilizer</li>
                            <li><strong>b‚ÇÄ</strong> is the y-intercept</li>
                            <li><strong>b‚ÇÅ</strong> is the slope, indicating how the yield changes with fertilizer</li>
                        </ul>
                        
                        <p><strong>3. Goal:</strong> The aim is to find the line that best fits the data points. This is achieved by minimizing the sum of squared residuals, which are the differences between the actual and predicted values.</p>
                        
                        <p><strong>4. Practical Example:</strong> In the context of potato farming, we look at how the yield changes with varying amounts of fertilizer. The best-fit line gives us a predictive relationship that helps optimize fertilizer usage for maximum yield.</p>
                    </div>
                </div>

                <div class="equation">
                    <h3>üéØ Target Equation</h3>
                    <div class="math">y = b‚ÇÄ + b‚ÇÅx</div>
                    <div class="math">Where:</div>
                    <div class="math">‚Ä¢ b‚ÇÄ = y-intercept</div>
                    <div class="math">‚Ä¢ b‚ÇÅ = slope</div>
                </div>

                <div id="currentLineInfo" class="current-line-info" style="display: none;">
                    <h4>üîç Current Line Analysis</h4>
                    <div id="lineEquation"></div>
                    <div id="lineError"></div>
                </div>

                <div id="calculationSteps" class="equation" style="display: none;">
                    <h3>üìê Detailed Calculation Steps</h3>
                    <div class="math">
                        <strong>Step 1 - Calculate Averages:</strong><br>
                        xÃÑ = (1+2+3+4+5)/5 = 15/5 = 3.0<br>
                        »≥ = (2+3+4+5+7)/5 = 21/5 = 4.2<br><br>
                        
                        <strong>Step 2 - Calculate Slope (b‚ÇÅ):</strong><br>
                        b‚ÇÅ = Œ£(x·µ¢ - xÃÑ)(y·µ¢ - »≥) / Œ£(x·µ¢ - xÃÑ)¬≤<br>
                        Numerator = (1-3)(2-4.2) + (2-3)(3-4.2) + (3-3)(4-4.2) + (4-3)(5-4.2) + (5-3)(7-4.2)<br>
                        = (-2)(-2.2) + (-1)(-1.2) + (0)(-0.2) + (1)(0.8) + (2)(2.8)<br>
                        = 4.4 + 1.2 + 0 + 0.8 + 5.6 = 12<br>
                        Denominator = (1-3)¬≤ + (2-3)¬≤ + (3-3)¬≤ + (4-3)¬≤ + (5-3)¬≤<br>
                        = 4 + 1 + 0 + 1 + 4 = 10<br>
                        b‚ÇÅ = 12/10 = 1.2<br><br>
                        
                        <strong>Step 3 - Calculate Intercept (b‚ÇÄ):</strong><br>
                        b‚ÇÄ = »≥ - b‚ÇÅxÃÑ = 4.2 - (1.2)(3) = 4.2 - 3.6 = 0.6
                    </div>
                </div>

                <div id="bestFitInfo" class="best-fit-info" style="display: none;">
                    <h3>üèÜ Best-Fit Line Found!</h3>
                    <div class="math"><strong>≈∑ = 0.6 + 1.2x</strong></div>
                    <div style="margin-top: 10px;">
                        <strong>Interpretation:</strong><br>
                        ‚Ä¢ Each kg of fertilizer increases yield by 1.2 tons<br>
                        ‚Ä¢ With 0 kg fertilizer, base yield is 0.6 tons<br>
                        ‚Ä¢ Sum of Squared Errors: <span id="finalSSE"></span>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%;"></div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <small id="progressText">Ready to start</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data points from the example
        const data = [
            {x: 1, y: 2},
            {x: 2, y: 3},
            {x: 3, y: 4},
            {x: 4, y: 5},
            {x: 5, y: 7}
        ];

        // Calculate means
        const xMean = data.reduce((sum, point) => sum + point.x, 0) / data.length;
        const yMean = data.reduce((sum, point) => sum + point.y, 0) / data.length;

        // Calculate best-fit parameters
        const numerator = data.reduce((sum, point) => sum + (point.x - xMean) * (point.y - yMean), 0);
        const denominator = data.reduce((sum, point) => sum + Math.pow(point.x - xMean, 2), 0);
        const bestB1 = numerator / denominator;
        const bestB0 = yMean - bestB1 * xMean;

        const canvas = document.getElementById('chart');
        const ctx = canvas.getContext('2d');
        
        let animationState = 'stopped';
        let currentStep = 0;
        let animationFrame;
        let animationSpeed = 800; // milliseconds between frames
        let isSlowMode = false;
        let isPaused = false;

        // Generate candidate lines to test
        const candidateLines = [];
        for (let b0 = -1; b0 <= 3; b0 += 0.4) {
            for (let b1 = 0.5; b1 <= 2; b1 += 0.15) {
                candidateLines.push({b0, b1});
            }
        }

        // Add the actual best fit line to ensure it's included
        candidateLines.push({b0: bestB0, b1: bestB1, isBest: true});

        function calculateSSE(b0, b1) {
            return data.reduce((sum, point) => {
                const predicted = b0 + b1 * point.x;
                return sum + Math.pow(point.y - predicted, 2);
            }, 0);
        }

        // Sort candidates by SSE
        candidateLines.forEach(line => {
            line.sse = calculateSSE(line.b0, line.b1);
        });
        candidateLines.sort((a, b) => a.sse - b.sse);

        function scaleX(x) {
            return 80 + (x - 0.5) * 100;
        }

        function scaleY(y) {
            return 450 - (y - 1) * 60;
        }

        function drawChart(currentLineIndex = -1, showResiduals = false) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 6; i++) {
                ctx.beginPath();
                ctx.moveTo(scaleX(i), 50);
                ctx.lineTo(scaleX(i), 450);
                ctx.stroke();
            }
            for (let i = 1; i <= 8; i++) {
                ctx.beginPath();
                ctx.moveTo(80, scaleY(i));
                ctx.lineTo(620, scaleY(i));
                ctx.stroke();
            }

            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(80, 450);
            ctx.lineTo(620, 450);
            ctx.moveTo(80, 50);
            ctx.lineTo(80, 450);
            ctx.stroke();

            // Draw axis labels
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            for (let i = 1; i <= 6; i++) {
                ctx.fillText(i.toString(), scaleX(i), 470);
            }
            ctx.textAlign = 'right';
            for (let i = 1; i <= 8; i++) {
                ctx.fillText(i.toString(), 75, scaleY(i) + 5);
            }

            // Axis titles
            ctx.textAlign = 'center';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('Fertilizer (kg)', 350, 495);
            ctx.save();
            ctx.translate(25, 250);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Potato Yield (tons)', 0, 0);
            ctx.restore();

            // Draw candidate lines (up to current)
            if (currentLineIndex >= 0) {
                for (let i = 0; i <= Math.min(currentLineIndex, candidateLines.length - 1); i++) {
                    const line = candidateLines[i];
                    const alpha = i === currentLineIndex ? 1 : 0.3;
                    const isWorst = line.sse === Math.max(...candidateLines.map(l => l.sse));
                    const color = line.isBest ? '#27ae60' : isWorst ? '#8b0000' : '#e74c3c';
                    
                    ctx.strokeStyle = color;
                    ctx.globalAlpha = alpha;
                    ctx.lineWidth = (line.isBest || isWorst) ? 4 : 2;
                    
                    ctx.beginPath();
                    const x1 = 0.5, x2 = 6;
                    const y1 = line.b0 + line.b1 * x1;
                    const y2 = line.b0 + line.b1 * x2;
                    ctx.moveTo(scaleX(x1), scaleY(y1));
                    ctx.lineTo(scaleX(x2), scaleY(y2));
                    ctx.stroke();
                    ctx.globalAlpha = 1;
                }
            }

            // Draw residuals for current line
            if (showResiduals && currentLineIndex >= 0) {
                const currentLine = candidateLines[currentLineIndex];
                ctx.strokeStyle = '#f39c12';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                data.forEach(point => {
                    const predicted = currentLine.b0 + currentLine.b1 * point.x;
                    ctx.beginPath();
                    ctx.moveTo(scaleX(point.x), scaleY(point.y));
                    ctx.lineTo(scaleX(point.x), scaleY(predicted));
                    ctx.stroke();
                });
                ctx.setLineDash([]);
            }

            // Draw data points (always on top)
            data.forEach(point => {
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(scaleX(point.x), scaleY(point.y), 8, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Label the points
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`(${point.x}, ${point.y})`, scaleX(point.x), scaleY(point.y) - 15);
            });
        }

        function updateCalculationSection(lineIndex) {
            const calculationSection = document.getElementById('calculationSection');
            if (lineIndex < 0) {
                calculationSection.style.display = 'none';
                return;
            }

            calculationSection.style.display = 'block';
            const line = candidateLines[lineIndex];
            
            // Update current equation display
            document.getElementById('currentEquationDisplay').textContent = 
                `y = ${line.b0.toFixed(2)} + ${line.b1.toFixed(2)}x`;
            document.getElementById('currentLineEq2').textContent = 
                `y = ${line.b0.toFixed(2)} + ${line.b1.toFixed(2)}x`;

            // Update calculation table
            const tableBody = document.getElementById('calculationTableBody');
            tableBody.innerHTML = '';
            
            let sseTotal = 0;
            let predictionStepsHtml = '<div style="background: #f0f4ff; padding: 15px; border-radius: 8px; margin: 10px 0;"><strong>üéØ Step-by-Step Predictions:</strong><br>';
            let residualStepsHtml = '<div style="background: #fff8f0; padding: 15px; border-radius: 8px; margin: 10px 0;"><strong>üìè Step-by-Step Residuals:</strong><br>';
            
            data.forEach((point, index) => {
                const predicted = line.b0 + line.b1 * point.x;
                const residual = point.y - predicted;
                const residualSquared = residual * residual;
                sseTotal += residualSquared;

                // Add to table
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td style="padding: 8px; text-align: center;">${point.x}</td>
                    <td style="padding: 8px; text-align: center;">${point.y}</td>
                    <td style="padding: 8px; text-align: center; color: #e74c3c;">${predicted.toFixed(2)}</td>
                    <td style="padding: 8px; text-align: center; color: ${residual >= 0 ? '#27ae60' : '#e74c3c'};">${residual.toFixed(2)}</td>
                    <td style="padding: 8px; text-align: center; color: #f39c12;">${residualSquared.toFixed(3)}</td>
                `;

                // Add detailed step-by-step calculations
                predictionStepsHtml += `
                    <div style="margin: 8px 0; padding: 8px; background: #fff; border-radius: 5px; border-left: 3px solid #667eea;">
                        <strong>Step ${index + 1}:</strong> For point (x=${point.x}, y=${point.y})<br>
                        ≈∑<sub>${index+1}</sub> = ${line.b0.toFixed(2)} + ${line.b1.toFixed(2)}(${point.x}) = ${line.b0.toFixed(2)} + ${(line.b1 * point.x).toFixed(2)} = <strong style="color: #e74c3c;">${predicted.toFixed(2)}</strong>
                    </div>
                `;
                
                residualStepsHtml += `
                    <div style="margin: 8px 0; padding: 8px; background: #fff; border-radius: 5px; border-left: 3px solid #f39c12;">
                        <strong>Step ${index + 1}:</strong> For point (x=${point.x}, y=${point.y})<br>
                        Using formula: <strong>e<sub>i</sub> = y<sub>i</sub> - ≈∑<sub>i</sub></strong><br>
                        e<sub>${index+1}</sub> = ${point.y} - ${predicted.toFixed(2)} = <strong style="color: ${residual >= 0 ? '#27ae60' : '#e74c3c'}">${residual.toFixed(2)}</strong>
                        ${residual > 0 ? ' (Under-prediction)' : residual < 0 ? ' (Over-prediction)' : ' (Perfect prediction!)'}
                    </div>
                `;
            });
            
            predictionStepsHtml += '</div>';
            residualStepsHtml += '</div>';

            document.getElementById('predictionSteps').innerHTML = predictionStepsHtml;
            document.getElementById('residualSteps').innerHTML = residualStepsHtml;

            // Enhanced SSE calculation with step numbering
            const sseHtml = `
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #f39c12;">
                    <strong>üìä Step-by-Step Sum of Squared Errors (SSE):</strong><br>
                    <div style="background: #f8f9ff; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <strong>Formula: SSE = Œ£e<sub>i</sub>¬≤ = Œ£(y<sub>i</sub> - ≈∑<sub>i</sub>)¬≤</strong>
                    </div>
                    
                    ${data.map((point, i) => {
                        const predicted = line.b0 + line.b1 * point.x;
                        const residual = point.y - predicted;
                        const residualSquared = residual * residual;
                        return `
                            <div style="margin: 5px 0; padding: 5px; background: #fff; border-radius: 3px;">
                                <strong>Step ${i + 1}:</strong> e<sub>${i+1}</sub>¬≤ = (${residual.toFixed(2)})¬≤ = ${residualSquared.toFixed(3)}
                            </div>
                        `;
                    }).join('')}
                    
                    <div style="margin: 10px 0; padding: 10px; background: #fff; border-radius: 5px; border: 2px solid #f39c12;">
                        <strong>Final Step:</strong> SSE = ${data.map((_, i) => `e<sub>${i+1}</sub>¬≤`).join(' + ')}<br>
                        SSE = ${data.map((point, i) => {
                            const predicted = line.b0 + line.b1 * point.x;
                            const residual = point.y - predicted;
                            return (residual * residual).toFixed(3);
                        }).join(' + ')}<br>
                        <strong style="color: #e74c3c; font-size: 18px;">SSE = ${sseTotal.toFixed(3)}</strong>
                    </div>
                    <em>üìâ Lower SSE = Better Fit!</em>
                </div>
            `;
            document.getElementById('sseCalculation').innerHTML = sseHtml;

            // Comparison with best so far
            const bestSoFar = Math.min(...candidateLines.slice(0, lineIndex + 1).map(l => l.sse));
            const isWorst = line.sse === Math.max(...candidateLines.map(l => l.sse));
            const comparisonBox = document.getElementById('comparisonBox');
            
            if (line.isBest) {
                comparisonBox.innerHTML = `
                    <div style="background: #d1ecf1; border: 2px solid #17a2b8; padding: 15px; border-radius: 10px;">
                        <strong>üéØ OPTIMAL SOLUTION FOUND!</strong><br>
                        This is the mathematically proven best-fit line<br>
                        Minimum possible SSE = ${line.sse.toFixed(3)}
                    </div>
                `;
            } else if (isWorst) {
                comparisonBox.innerHTML = `
                    <div style="background: #f8d7da; border: 2px solid #dc3545; padding: 15px; border-radius: 10px;">
                        <strong>üíÄ WORST-FIT LINE!</strong><br>
                        This line has the highest SSE among tested lines<br>
                        Maximum SSE = ${line.sse.toFixed(3)}
                    </div>
                `;
            } else if (line.sse === bestSoFar) {
                comparisonBox.innerHTML = `
                    <div style="background: #d4edda; border: 2px solid #28a745; padding: 15px; border-radius: 10px;">
                        <strong>üèÜ NEW BEST LINE!</strong><br>
                        This line has the lowest SSE so far: ${line.sse.toFixed(3)}
                    </div>
                `;
            } else {
                comparisonBox.innerHTML = `
                    <div style="background: #f8d7da; border: 2px solid #dc3545; padding: 15px; border-radius: 10px;">
                        <strong>‚ùå Not the best fit</strong><br>
                        SSE = ${line.sse.toFixed(3)} > Best so far = ${bestSoFar.toFixed(3)}
                    </div>
                `;
            }
        }

        function updateInfoPanel(lineIndex) {
            const currentLineInfo = document.getElementById('currentLineInfo');
            const lineEquation = document.getElementById('lineEquation');
            const lineError = document.getElementById('lineError');
            const stepIndicator = document.getElementById('stepIndicator');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            if (lineIndex >= 0 && lineIndex < candidateLines.length) {
                const line = candidateLines[lineIndex];
                const isWorst = line.sse === Math.max(...candidateLines.map(l => l.sse));
                
                currentLineInfo.style.display = 'block';
                
                lineEquation.innerHTML = `<strong>y = ${line.b0.toFixed(2)} + ${line.b1.toFixed(2)}x</strong>`;
                lineError.innerHTML = `Sum of Squared Errors: <strong>${line.sse.toFixed(3)}</strong>`;
                
                const progress = ((lineIndex + 1) / candidateLines.length) * 100;
                progressBar.style.width = progress + '%';
                progressText.textContent = `Testing line ${lineIndex + 1} of ${candidateLines.length}`;
                
                if (line.isBest) {
                    stepIndicator.textContent = 'üèÜ Best-Fit Line Found!';
                    document.getElementById('bestFitInfo').style.display = 'block';
                    document.getElementById('finalSSE').textContent = line.sse.toFixed(3);
                    document.getElementById('calculationSteps').style.display = 'block';
                } else if (isWorst) {
                    stepIndicator.textContent = 'üíÄ Worst-Fit Line Displayed!';
                    document.getElementById('bestFitInfo').style.display = 'none';
                    document.getElementById('calculationSteps').style.display = 'none';
                } else {
                    stepIndicator.textContent = `Testing candidate line ${lineIndex + 1}...`;
                }
            }
            
            // Update the calculation section
            updateCalculationSection(lineIndex);
        }

        function toggleSpeed() {
            isSlowMode = !isSlowMode;
            animationSpeed = isSlowMode ? 1500 : 800;
            const speedButton = document.getElementById('speedToggle');
            speedButton.textContent = isSlowMode ? 'üöÄ Fast Mode' : 'üêå Slow Mode';
        }

        function togglePause() {
            isPaused = !isPaused;
            const pauseButton = document.getElementById('pauseToggle');
            
            if (isPaused) {
                pauseButton.textContent = '‚ñ∂Ô∏è Resume';
                if (animationFrame) {
                    clearTimeout(animationFrame);
                }
            } else {
                pauseButton.textContent = '‚è∏Ô∏è Pause';
                if (animationState === 'running') {
                    // Resume animation
                    animate();
                }
            }
        }

        function animate() {
            if (animationState !== 'running' || isPaused) return;
            
            if (currentStep < candidateLines.length) {
                drawChart(currentStep, true);
                updateInfoPanel(currentStep);
                currentStep++;
                animationFrame = setTimeout(animate, animationSpeed);
            } else {
                animationState = 'completed';
                document.getElementById('pauseToggle').style.display = 'none';
                // Find and highlight the best line
                const bestLineIndex = candidateLines.findIndex(line => line.isBest);
                drawChart(bestLineIndex, true);
                updateInfoPanel(bestLineIndex);
            }
        }

        function startAnimation() {
            if (animationState === 'running') return;
            
            animationState = 'running';
            isPaused = false;
            currentStep = 0;
            
            document.getElementById('bestFitInfo').style.display = 'none';
            document.getElementById('calculationSteps').style.display = 'none';
            document.getElementById('pauseToggle').style.display = 'inline-block';
            document.getElementById('pauseToggle').textContent = '‚è∏Ô∏è Pause';
            
            animate();
        }

        function resetAnimation() {
            animationState = 'stopped';
            isPaused = false;
            if (animationFrame) clearTimeout(animationFrame);
            currentStep = 0;
            
            drawChart();
            document.getElementById('currentLineInfo').style.display = 'none';
            document.getElementById('bestFitInfo').style.display = 'none';
            document.getElementById('calculationSteps').style.display = 'none';
            document.getElementById('calculationSection').style.display = 'none';
            document.getElementById('pauseToggle').style.display = 'none';
            document.getElementById('stepIndicator').textContent = 'Click "Start Animation" to begin';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = 'Ready to start';
        }

        function showBestFit() {
            animationState = 'stopped';
            if (animationFrame) clearTimeout(animationFrame);
            
            const bestLineIndex = candidateLines.findIndex(line => line.isBest);
            drawChart(bestLineIndex, true);
            updateInfoPanel(bestLineIndex);
        }

        function showWorstFit() {
            animationState = 'stopped';
            if (animationFrame) clearTimeout(animationFrame);
            
            // Find the worst line (highest SSE)
            const worstLineIndex = candidateLines.findIndex(line => 
                line.sse === Math.max(...candidateLines.map(l => l.sse))
            );
            
            drawChart(worstLineIndex, true);
            updateInfoPanel(worstLineIndex);
        }

        // Initialize the chart
        drawChart();

        // Add some educational text
        const educationalText = document.createElement('div');
        educationalText.className = 'equation';
        educationalText.innerHTML = `
            <h3>üß† How Linear Regression Works</h3>
            <p><strong>The Process:</strong></p>
            <p>1. <strong>Test Multiple Lines:</strong> We systematically try different combinations of slope (b‚ÇÅ) and intercept (b‚ÇÄ) values</p>
            <p>2. <strong>Measure Prediction Errors:</strong> For each candidate line, we calculate how far off our predictions are from the actual data points</p>
            <p>3. <strong>Calculate Sum of Squared Errors (SSE):</strong> We square each error and sum them up - this penalizes larger errors more heavily</p>
            <p>4. <strong>Find the Minimum:</strong> The line with the smallest SSE becomes our best-fit line</p>
            <p>5. <strong>Make Predictions:</strong> Use the final equation ≈∑ = 0.6 + 1.2x to predict potato yield for any fertilizer amount</p>
            <br>
            <p><strong>Key Insights from Our Example:</strong></p>
            <p>‚Ä¢ <strong>Slope (1.2):</strong> Each additional kg of fertilizer increases yield by 1.2 tons</p>
            <p>‚Ä¢ <strong>Intercept (0.6):</strong> Even with 0 kg fertilizer, we expect 0.6 tons base yield</p>
            <p>‚Ä¢ <strong>Practical Application:</strong> Farmers can optimize fertilizer usage for maximum yield</p>
            <p>‚Ä¢ <strong>Residuals:</strong> The yellow dotted lines show prediction errors - smaller residuals mean better predictions</p>
        `;
        document.querySelector('.info-panel').appendChild(educationalText);

    </script>
</body>
</html>